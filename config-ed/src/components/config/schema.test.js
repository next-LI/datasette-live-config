/* eslint-env node, jest */

import { h } from "preact";
import render from "preact-render-to-string";
import {
  to_metadata_arrays, to_metadata_obj
} from "./schema.js";

function getOriginal() {
  return {'title': 'Demo instance for datasette-csv-importer', 'description_html': " <p>Our datasette-csv-importer plugin is for live-uploading CSV files with a user-friendly configuration UI that doesn't require the application to be restarted to work.</p> <p>If you'd like to run a local instance of your own, you can clone our project <a href='https://github.com/next-LI/datasette-csv-importer'>here</a>. Note that this is in active development and we are using feedback from this demo to help us focus our next steps.</p> <h3>How to use</h3> <p>We've loaded some example datasets that illustrate some of the capabilities of Datasette. The <code>ny_electoral_districts</code> and <code>congressional_districts</code> contain geospatial data, which you can see by <a href='/ny_electoral_districts/ny_electoral_districts'>checking the records</a>.</p> <p>There is <em>currently no way</em> to manually delete the data you've uploaded to this instance. We will be wiping all the data eventually, but if you've accidentally uploaded something sensitive - email <a href='mailto:brandon@bxroberts.org'>Brandon Roberts</a> or <a href='mailto:kai.teoh@newsday.com'>Kai Teoh</a>.</p> <p>All the fields on the upload page is optional.</p> <ol> <li>Click the menu icon on the top right of the screen</li> <li>Click 'Sign in with GitHub'</li> <li>You'll be asked to approve our app</li> <li>Once logged in, click the menu icon again, select 'Import CSV'</li> <li>Drag and drop your CSV</li> <li>Click 'Submit'</li> </ol> <h3>Let us know your thoughts</h3> <p>You can fill in <a href='https://docs.google.com/forms/d/e/1FAIpQLSc1xFdLpxOKB3fBbHyF22fH_IP4xB4Wj0RCxy0UVlCkJZm0qA/viewform'>this form here</a> or <a href='mailto:kai.teoh@newsday.com?cc=brandon@bxroberts.org'>send us an email</a>.</p>", 'allow': {"id": "root"}, 'size': 25, 'extra_css_urls': ['/static/css/nextli.css'], 'plugins': {'datasette-auth-github': {'client_id': {'$env': 'GITHUB_CLIENT_ID'}, 'client_secret': {'$env': 'GITHUB_CLIENT_SECRET'}}, 'datasette-csv-importer': {'csv_path': 'csvs', 'database_path': '.'}, 'datasette-ripgrep': {'path': 'csvs'}}, 'databases': {'congressional_districts': {'title': '2020 Congressional Districts', 'source': 'United States Census Bureau', 'source_url': 'https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html', 'description': 'Source: US Census Bureau. All legal boundaries and names are as of January 1, 2020. Released February 2, 2021.', 'tables': {'2020_congressioinal_districts': {'title': 'Congressional Districts - 116th Congress', 'size': 5}}}, 'congressional_bills': {'title': 'U.S. Congress: Bulk Data on Bills', 'source': "ProPublica's Represent App", 'source_url': 'https://www.propublica.org/datastore/dataset/congressional-data-bulk-legislation-bills'}, 'ny_electoral_districts': {'title': 'NY State Assembly Districts - Long Island and greater NYC', 'source': 'Newsday', 'tables': {'ny_electoral_districts': {'size': 5}}}, 'proposed_gunlaws': {'title': 'Proposed gun law bills', 'source': 'Newsday'}}};
}

function getFlat() {
  return {"title": "Demo instance for datasette-csv-importer", "description_html": " <p>Our datasette-csv-importer plugin is for live-uploading CSV files with a user-friendly configuration UI that doesn't require the application to be restarted to work.</p> <p>If you'd like to run a local instance of your own, you can clone our project <a href='https://github.com/next-LI/datasette-csv-importer'>here</a>. Note that this is in active development and we are using feedback from this demo to help us focus our next steps.</p> <h3>How to use</h3> <p>We've loaded some example datasets that illustrate some of the capabilities of Datasette. The <code>ny_electoral_districts</code> and <code>congressional_districts</code> contain geospatial data, which you can see by <a href='/ny_electoral_districts/ny_electoral_districts'>checking the records</a>.</p> <p>There is <em>currently no way</em> to manually delete the data you've uploaded to this instance. We will be wiping all the data eventually, but if you've accidentally uploaded something sensitive - email <a href='mailto:brandon@bxroberts.org'>Brandon Roberts</a> or <a href='mailto:kai.teoh@newsday.com'>Kai Teoh</a>.</p> <p>All the fields on the upload page is optional.</p> <ol> <li>Click the menu icon on the top right of the screen</li> <li>Click 'Sign in with GitHub'</li> <li>You'll be asked to approve our app</li> <li>Once logged in, click the menu icon again, select 'Import CSV'</li> <li>Drag and drop your CSV</li> <li>Click 'Submit'</li> </ol> <h3>Let us know your thoughts</h3> <p>You can fill in <a href='https://docs.google.com/forms/d/e/1FAIpQLSc1xFdLpxOKB3fBbHyF22fH_IP4xB4Wj0RCxy0UVlCkJZm0qA/viewform'>this form here</a> or <a href='mailto:kai.teoh@newsday.com?cc=brandon@bxroberts.org'>send us an email</a>.</p>", "allow": "{\"id\":\"root\"}", "size": 25, "extra_css_urls": ["/static/css/nextli.css"], "plugins": "{\"datasette-auth-github\":{\"client_id\":{\"$env\":\"GITHUB_CLIENT_ID\"},\"client_secret\":{\"$env\":\"GITHUB_CLIENT_SECRET\"}},\"datasette-csv-importer\":{\"csv_path\":\"csvs\",\"database_path\":\".\"},\"datasette-ripgrep\":{\"path\":\"csvs\"}}", "databases": [{"title": "2020 Congressional Districts", "source": "United States Census Bureau", "source_url": "https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html", "description": "Source: US Census Bureau. All legal boundaries and names are as of January 1, 2020. Released February 2, 2021.", "tables": [{"_name": "2020_congressioinal_districts", "title": "Congressional Districts - 116th Congress", "size": 5}], "_name": "congressional_districts"}, {"title": "U.S. Congress: Bulk Data on Bills", "source": "ProPublica's Represent App", "source_url": "https://www.propublica.org/datastore/dataset/congressional-data-bulk-legislation-bills", "_name": "congressional_bills"}, {"title": "NY State Assembly Districts - Long Island and greater NYC", "source": "Newsday", "tables": [{"size": 5, "_name": "ny_electoral_districts"}], "_name": "ny_electoral_districts"}, {"title": "Proposed gun law bills", "source": "Newsday", "_name": "proposed_gunlaws"}]};
}

describe("Metadata converter", () => {
  it("should be able to run tests", () => {
    expect(true).toEqual(true);
  });
  it("should be able to turn an arrayed config to a key-value object ", () => {
    expect(to_metadata_obj(getFlat())).toEqual(getOriginal());
  });
  it("should be able to turn a key-value config to an array based object", () => {
    expect(to_metadata_arrays(getOriginal())).toEqual(getFlat());
  });
});
